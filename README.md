# Hurricane

Hurricane Robot Control System for SJTU RoboMaster Competition

This project is generated with STM32CubeMX and built with CMake.

This project requires [CAHRR](https://github.com/SkyZH/CAHRR).

## Structure

All directory except Src-CAH are generated by STM32CubeMX.

`Src/runtime` contains Dajiang official code.

We've made changes to `Src/stm32f4xx_it.c` and `main.c`, to redirect interrupts to Hurricane system and bootstrap the Hurricane control system.

### Systems

* HurricaneArmSystem - control two arms of our robot
* HurricaneCANSystem - control CAN devices
* HurricaneChassisSystem - control chassis
* <del>HurricaneClawSystem - control claw, which is built with potentiometer and pwm motor</del>
* HurricaneClawSystem - control claw for collecting buff and elevator for the claw
* HurricaneCollectorSystem - control ball collector, which is built with servo
* HurricaneDebugSystem - transmit debug information
* HurricaneGPIOSystem - process GPIO interrupts
* HurricaneIMUSystem - get gyro data
* HurricaneRemoteSystem - get data from Dajiang joystick
* <del>HurricaneUltrasonicSystem - get data from ultrasonic sensors</del>

### Tasks

* ArmTask - control arm
* TimedTask - timing task on STM32
* MainSwitchTask(s) - joystick switch control
* SaveDriveTask - control chassis when saving other robots
* ServoTask - control servo of ball collector
* TankDriveTask - control chassis

In particular, MainTask
```cpp
Task *mainTask() {
    return new ParallelTask(std::vector<Task *>({
            new LeftSwitchNone(
                    nullptr,                                     // [1]
                    new RightSwitchBottom(
                            new LeftSwitchBottom(
                                    new LeftSwitchTop(
                                            new TankDriveTask,   // [4]
                                            nullptr
                                    ),
                                    new SaveDriveTask            // [3]
                            ),
                            new ArmTask                          // [2]
                    )

            ),
            new RightSwitchTopTrigger(                           // [5]
                    new CollectorCloseTask,
                    new CollectorOpenTask)
    }));
}
```

Tasks are executed in the following sequence

[1] If joystick is not connected, do nothing.    
[2] If right switch is switched to bottom, control arm.    
[3] If left switch is switched to bottom, control chassis in save mode.    
[4] If left switch is switched to middle, control chassis    
[5] If right switch is switched to top, open or close the collector.

### Models

* Arm, ArmBottom, ArmTop - PID control of different arms
* ArmBase - PID control of arm base

### Other things

* OI - pack all systems and bootstrap tasks
* HAL - include all HAL libraries

### Building

You can deploy the project with CLion with STM32 plugin.

## License

MIT

## SJTU RoboMaster Competition

We won the eighth place in the first SJTU (Inter-Campus) RoboMaster Competition. Here's our chaotic robot.

![mr4js8y7rrgl0apwn7sytq_thumb_5d22](https://user-images.githubusercontent.com/4198311/50549040-40e43680-0c91-11e9-8176-afe08dcd839e.jpg)
![byvrruayqjucbo0 yjd6pw_thumb_5d21](https://user-images.githubusercontent.com/4198311/50549042-4477bd80-0c91-11e9-8200-d59d6488627e.jpg)

I personally would like to thank [Shaofei Qin](https://github.com/1105042987) and SJTU RoboMaster Team. Thank for their open-source project [RM_frame](https://github.com/1105042987/RM_frame). Without them there won't be Hurricane and CAHRR. I learned a lot through the building of this project on embedded system STM32.

